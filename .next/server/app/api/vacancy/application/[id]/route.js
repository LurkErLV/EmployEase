"use strict";(()=>{var e={};e.id=882,e.ids=[882],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},60711:(e,a,r)=>{r.r(a),r.d(a,{headerHooks:()=>x,originalPathname:()=>w,patchFetch:()=>g,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>v,staticGenerationAsyncStorage:()=>y,staticGenerationBailout:()=>f});var t={};r.r(t),r.d(t,{POST:()=>l});var s=r(95419),i=r(69108),n=r(99678),o=r(23106),c=r(78070),p=r(81355),u=r(83411);async function l(e,{params:a}){let r=await (0,p.getServerSession)(u.L);if(!r)return c.Z.json({ok:!1,message:"You are unauthorized"},{status:401});let t=await o.Z.vacancy.findFirst({where:{id:parseInt(a.id)}}).finally(()=>{o.Z.$disconnect()});return t?r.user.id.toString()===t.authorId.toString()?c.Z.json({ok:!1,message:"User is author of vacancy"},{status:405}):await o.Z.application.findFirst({where:{userId:parseInt(r.user.id),vacancyId:t.id}}).finally(()=>{o.Z.$disconnect()})?c.Z.json({ok:!1,message:"User already applied"},{status:409}):await o.Z.application.create({data:{vacancyId:parseInt(a.id),userId:parseInt(r.user.id)}}).finally(()=>{o.Z.$disconnect()})?c.Z.json({ok:!0},{status:200}):c.Z.json({ok:!1,message:"Some error occurred"},{status:400}):c.Z.json({ok:!1,message:"Vacancy not found"},{status:404})}let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/vacancy/application/[id]/route",pathname:"/api/vacancy/application/[id]",filename:"route",bundlePath:"app/api/vacancy/application/[id]/route"},resolvedPagePath:"/Users/lurker/Desktop/employease/app/api/vacancy/application/[id]/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:m,staticGenerationAsyncStorage:y,serverHooks:v,headerHooks:x,staticGenerationBailout:f}=d,w="/api/vacancy/application/[id]/route";function g(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:y})}},83411:(e,a,r)=>{r.d(a,{L:()=>n});var t=r(86485),s=r(23106),i=r(6521);let n={secret:process.env.AUTH_SECRET,session:{strategy:"jwt"},providers:[(0,t.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"}},async authorize(e,a){if(!e)return;let{email:r,password:t}=e,n=await s.Z.user.findFirst({where:{email:r},include:{application:!0,vacancies:!0}}).finally(()=>{s.Z.$disconnect()});if(!n)throw Error("User not found!");if(!await (0,i.compare)(t,n.password))throw Error("Incorrect password");return{id:n.id,email:n.email,name:n.name,surname:n.surname,role:n.Role,application:n.application,vacancies:n.vacancies}}})],pages:{signIn:`${process.env.BASE_PATH}/auth/signin`,newUser:process.env.BASE_PATH},callbacks:{jwt:async({token:e})=>e,session:async({session:e,token:a})=>{if(!a.email)return null;let r=await s.Z.user.findFirst({where:{email:a.email},include:{application:!0,vacancies:!0}}).finally(()=>{s.Z.$disconnect()});return r?(e.user={id:r.id,email:r.email,name:r.name,surname:r.surname,role:r.Role,application:r.application,vacancies:r.vacancies},e):null}}}},23106:(e,a,r)=>{r.d(a,{Z:()=>t});let t=new(r(53524)).PrismaClient}};var a=require("../../../../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),t=a.X(0,[431,521,123,206],()=>r(60711));module.exports=t})();